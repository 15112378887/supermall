{"remainingRequest":"D:\\新建文件夹\\vue.js练习\\项目\\supermall\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\新建文件夹\\vue.js练习\\项目\\supermall\\src\\views\\detail\\Detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\新建文件夹\\vue.js练习\\项目\\supermall\\src\\views\\detail\\Detail.vue","mtime":1571497041307},{"path":"D:\\新建文件夹\\vue.js练习\\项目\\supermall\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\新建文件夹\\vue.js练习\\项目\\supermall\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\新建文件夹\\vue.js练习\\项目\\supermall\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\新建文件夹\\vue.js练习\\项目\\supermall\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport DetailNav from \"./DetailChild/DetailNav\";\r\nimport DetailSwiper from \"./DetailChild/DetailSwiper\";\r\nimport DetailBaseInfo from \"./DetailChild/DetailBaseInfo\";\r\nimport DetailShopInfo from \"./DetailChild/DetailShopInfo\";\r\nimport Scroll from \"components/common/scroll/Scroll\";\r\nimport DetailGoodsInfo from \"./DetailChild/DetailGoodsInfo\";\r\nimport DetailParamInfo from \"./DetailChild/DetailParamInfo\";\r\nimport DetailCommentInfo from \"./DetailChild/DetailCommentInfo\";\r\nimport GoodsList from \"components/content/goods/GoodsList\";\r\nimport DetailBottomBar from \"./DetailChild/DetailBottomBar\";\r\n// import Toast from 'components/common/toast/Toast'\r\n\r\nimport {getDetail,Goods,getRecommend,Shop,GoodsParam } from \"network/detail\";\r\nimport { debounce } from \"common/until\";\r\nimport { itemListenerMixin, backTopMixin } from \"common/mixin\";\r\nimport { mapActions } from 'vuex'\r\n\r\nexport default {\r\n  name: \"Detail\",\r\n\r\n  components: {\r\n    DetailNav,\r\n    DetailSwiper,\r\n    DetailBaseInfo,\r\n    DetailShopInfo,\r\n    DetailGoodsInfo,\r\n    DetailParamInfo,\r\n    DetailCommentInfo,\r\n    DetailBottomBar,\r\n\r\n    Scroll,\r\n    GoodsList,\r\n    \r\n    \r\n  },\r\n  mixins: [itemListenerMixin, backTopMixin],\r\n  data() {\r\n    return {\r\n      iid: 0,\r\n      topImages: [],\r\n      goods: {},\r\n      shop: {},\r\n      detailInfo: {},\r\n      paramInfo: {},\r\n      commentInfo: {},\r\n      recommend: [],\r\n      navYs: [],\r\n      getThemeTopY: null,\r\n      currentIndex: 0\r\n    };\r\n  },\r\n\r\n  created() {\r\n    //请求数据详情数据\r\n    this.iid = this.$route.params.iid;\r\n    getDetail(this.iid).then(res => {\r\n      const data = res.data.result;\r\n      // 获取详情页轮播图图片\r\n      this.topImages = data.itemInfo.topImages;\r\n      //详情页标题信息\r\n      this.goods = new Goods(\r\n        data.itemInfo,\r\n        data.columns,\r\n        data.shopInfo.services\r\n      );\r\n      //详情页店铺信息\r\n      this.shop = new Shop(data.shopInfo);\r\n      // 获取详情页展示图片\r\n      this.detailInfo = data.detailInfo;\r\n      // 获取详情页参数\r\n      this.paramInfo = new GoodsParam(\r\n        data.itemParams.info,\r\n        data.itemParams.rule\r\n      );\r\n      //获取评论信息\r\n      if (data.rate.cRate !== 0) {\r\n        this.commentInfo = data.rate.list[0];\r\n      }\r\n    });\r\n    //请求推荐数据\r\n    getRecommend().then(res => {\r\n      this.recommend = res.data.data.list;\r\n    });\r\n    //给getThemeTopY赋值\r\n    this.getThemeTopY = debounce(() => {\r\n      this.navYs = [];\r\n      this.navYs.push(0);\r\n      this.navYs.push(this.$refs.param.$el.offsetTop + -44);\r\n      this.navYs.push(this.$refs.comment.$el.offsetTop + -44);\r\n      this.navYs.push(this.$refs.recommend.$el.offsetTop + -44);\r\n      this.navYs.push(Number.MAX_VALUE);\r\n    }, 500);\r\n  },\r\n  mounted() {},\r\n\r\n  destroyed() {\r\n    this.$bus.$off(\"itemImageLoad\", this.itemListener);\r\n  },\r\n  methods: {\r\n    ...mapActions(['addCart']),\r\n    //解决滚动问题\r\n    itemImageLoad() {\r\n      this.$refs.scroll.refresh();\r\n      this.getThemeTopY();\r\n    },\r\n    //标题点击滚动到对应页面\r\n    itemClick(index) {\r\n      this.$refs.scroll.scrollTo(0, -this.navYs[index], 100);\r\n    },\r\n    //根据滚动的页面位置，切换nav的选中状态\r\n    contentScroll(position) {\r\n      const positionY = -position.y;\r\n      let length = this.navYs.length;\r\n      for (let i = 0; i < length - 1; i++) {\r\n        if (\r\n          this.currentIndex !== i &&\r\n          (i < length - 1 &&\r\n            positionY >= this.navYs[i] &&\r\n            positionY < this.navYs[i + 1])\r\n        ) {\r\n          this.currentIndex = i;\r\n          this.$refs.nav.currentIndex = this.currentIndex;\r\n        }\r\n      }\r\n      this.listenShopBack(position);\r\n    },\r\n    //获取购物车展示信息\r\n    addToCart() {\r\n      const product = {};\r\n      product.image = this.topImages[0];\r\n      product.title = this.goods.title;\r\n      product.desc = this.goods.desc;\r\n      product.price = this.goods.realPrice;\r\n      product.iid = this.iid;\r\n\r\n      //2将商品添加到购物车\r\n      this.addCart(product).then(res => {\r\n       this.$toast.show(res, 1000)\r\n        \r\n      })\r\n      // this.$store.dispatch(\"addCart\", product).then(res => {\r\n      //   \r\n      //    \r\n      // });\r\n    }\r\n  }\r\n};\r\n",{"version":3,"sources":["Detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Detail.vue","sourceRoot":"src/views/detail","sourcesContent":["<template>\r\n  <div id=\"detail\">\r\n    <detail-nav class=\"detail-nav\" @itemClick=\"itemClick\" ref=\"nav\"></detail-nav>\r\n\r\n    <scroll class=\"content\" ref=\"scroll\" :probe-type=\"3\" @scroll=\"contentScroll\">\r\n      <detail-swiper :top-images=\"topImages\"></detail-swiper>\r\n      <detail-base-info :goods=\"goods\"></detail-base-info>\r\n      <detail-shop-info :shop=\"shop\"></detail-shop-info>\r\n      <detail-goods-info :detail-info=\"detailInfo\" @itemImageLoad=\"itemImageLoad\"></detail-goods-info>\r\n      <detail-param-info :paramInfo=\"paramInfo\" ref=\"param\"></detail-param-info>\r\n      <detail-comment-info :commentInfo=\"commentInfo\" ref=\"comment\"></detail-comment-info>\r\n      <goods-list :goods=\"recommend\" ref=\"recommend\"></goods-list>\r\n    </scroll>\r\n    <detail-bottom-bar @addToCart=\"addToCart\"></detail-bottom-bar>\r\n    <back-top @click.native=\"backClick\" v-show=\"isShowBackTop\"></back-top>\r\n    <!-- <toast message=\"加入购物车成功\"></toast> -->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport DetailNav from \"./DetailChild/DetailNav\";\r\nimport DetailSwiper from \"./DetailChild/DetailSwiper\";\r\nimport DetailBaseInfo from \"./DetailChild/DetailBaseInfo\";\r\nimport DetailShopInfo from \"./DetailChild/DetailShopInfo\";\r\nimport Scroll from \"components/common/scroll/Scroll\";\r\nimport DetailGoodsInfo from \"./DetailChild/DetailGoodsInfo\";\r\nimport DetailParamInfo from \"./DetailChild/DetailParamInfo\";\r\nimport DetailCommentInfo from \"./DetailChild/DetailCommentInfo\";\r\nimport GoodsList from \"components/content/goods/GoodsList\";\r\nimport DetailBottomBar from \"./DetailChild/DetailBottomBar\";\r\n// import Toast from 'components/common/toast/Toast'\r\n\r\nimport {getDetail,Goods,getRecommend,Shop,GoodsParam } from \"network/detail\";\r\nimport { debounce } from \"common/until\";\r\nimport { itemListenerMixin, backTopMixin } from \"common/mixin\";\r\nimport { mapActions } from 'vuex'\r\n\r\nexport default {\r\n  name: \"Detail\",\r\n\r\n  components: {\r\n    DetailNav,\r\n    DetailSwiper,\r\n    DetailBaseInfo,\r\n    DetailShopInfo,\r\n    DetailGoodsInfo,\r\n    DetailParamInfo,\r\n    DetailCommentInfo,\r\n    DetailBottomBar,\r\n\r\n    Scroll,\r\n    GoodsList,\r\n    \r\n    \r\n  },\r\n  mixins: [itemListenerMixin, backTopMixin],\r\n  data() {\r\n    return {\r\n      iid: 0,\r\n      topImages: [],\r\n      goods: {},\r\n      shop: {},\r\n      detailInfo: {},\r\n      paramInfo: {},\r\n      commentInfo: {},\r\n      recommend: [],\r\n      navYs: [],\r\n      getThemeTopY: null,\r\n      currentIndex: 0\r\n    };\r\n  },\r\n\r\n  created() {\r\n    //请求数据详情数据\r\n    this.iid = this.$route.params.iid;\r\n    getDetail(this.iid).then(res => {\r\n      const data = res.data.result;\r\n      // 获取详情页轮播图图片\r\n      this.topImages = data.itemInfo.topImages;\r\n      //详情页标题信息\r\n      this.goods = new Goods(\r\n        data.itemInfo,\r\n        data.columns,\r\n        data.shopInfo.services\r\n      );\r\n      //详情页店铺信息\r\n      this.shop = new Shop(data.shopInfo);\r\n      // 获取详情页展示图片\r\n      this.detailInfo = data.detailInfo;\r\n      // 获取详情页参数\r\n      this.paramInfo = new GoodsParam(\r\n        data.itemParams.info,\r\n        data.itemParams.rule\r\n      );\r\n      //获取评论信息\r\n      if (data.rate.cRate !== 0) {\r\n        this.commentInfo = data.rate.list[0];\r\n      }\r\n    });\r\n    //请求推荐数据\r\n    getRecommend().then(res => {\r\n      this.recommend = res.data.data.list;\r\n    });\r\n    //给getThemeTopY赋值\r\n    this.getThemeTopY = debounce(() => {\r\n      this.navYs = [];\r\n      this.navYs.push(0);\r\n      this.navYs.push(this.$refs.param.$el.offsetTop + -44);\r\n      this.navYs.push(this.$refs.comment.$el.offsetTop + -44);\r\n      this.navYs.push(this.$refs.recommend.$el.offsetTop + -44);\r\n      this.navYs.push(Number.MAX_VALUE);\r\n    }, 500);\r\n  },\r\n  mounted() {},\r\n\r\n  destroyed() {\r\n    this.$bus.$off(\"itemImageLoad\", this.itemListener);\r\n  },\r\n  methods: {\r\n    ...mapActions(['addCart']),\r\n    //解决滚动问题\r\n    itemImageLoad() {\r\n      this.$refs.scroll.refresh();\r\n      this.getThemeTopY();\r\n    },\r\n    //标题点击滚动到对应页面\r\n    itemClick(index) {\r\n      this.$refs.scroll.scrollTo(0, -this.navYs[index], 100);\r\n    },\r\n    //根据滚动的页面位置，切换nav的选中状态\r\n    contentScroll(position) {\r\n      const positionY = -position.y;\r\n      let length = this.navYs.length;\r\n      for (let i = 0; i < length - 1; i++) {\r\n        if (\r\n          this.currentIndex !== i &&\r\n          (i < length - 1 &&\r\n            positionY >= this.navYs[i] &&\r\n            positionY < this.navYs[i + 1])\r\n        ) {\r\n          this.currentIndex = i;\r\n          this.$refs.nav.currentIndex = this.currentIndex;\r\n        }\r\n      }\r\n      this.listenShopBack(position);\r\n    },\r\n    //获取购物车展示信息\r\n    addToCart() {\r\n      const product = {};\r\n      product.image = this.topImages[0];\r\n      product.title = this.goods.title;\r\n      product.desc = this.goods.desc;\r\n      product.price = this.goods.realPrice;\r\n      product.iid = this.iid;\r\n\r\n      //2将商品添加到购物车\r\n      this.addCart(product).then(res => {\r\n       this.$toast.show(res, 1000)\r\n        \r\n      })\r\n      // this.$store.dispatch(\"addCart\", product).then(res => {\r\n      //   \r\n      //    \r\n      // });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n#detail {\r\n  position: relative;\r\n  z-index: 9;\r\n  background-color: #ffffff;\r\n  height: 100vh;\r\n}\r\n.detail-nav {\r\n  position: relative;\r\n  background-color: #ffffff;\r\n  z-index: 9;\r\n}\r\n.content {\r\n  height: calc(100% - 44px - 49px);\r\n}\r\n</style>>\r\n\r\n\r\n"]}]}